<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quick DAMP Voting Setup</title>

    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
            color: white;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }

        .setup-container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(15px);
        }

        button {
            background: linear-gradient(45deg, #00d4ff, #0099cc);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 212, 255, 0.4);
        }

        .log {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }

        .success { color: #00ff88; }
        .error { color: #ff4757; }
        .info { color: #00d4ff; }
    </style>
</head>
<body>
    <div class="setup-container">
        <h1>‚ö° Quick DAMP Voting Setup</h1>
        <p>This bypasses security rules and creates the voting data directly via REST API.</p>

        <button onclick="setupViaREST()">üöÄ Setup Via REST API</button>
        <button onclick="clearLog()">üóëÔ∏è Clear Log</button>

        <div id="log" class="log">Ready for quick setup...\n</div>

        <div style="margin-top: 20px; padding: 15px; background: rgba(0, 212, 255, 0.1); border-radius: 8px;">
            <strong>Next Steps:</strong><br>
            1. Click "Setup Via REST API" above<br>
            2. Check Emulator UI: <a href="http://localhost:4000/firestore" target="_blank">http://localhost:4000/firestore</a><br>
            3. Test Voting: <a href="http://localhost:5000/test-voting-system.html" target="_blank">test-voting-system.html</a>
        </div>
    </div>

    <script>
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'error' ? '‚ùå' : type === 'success' ? '‚úÖ' : '‚ÑπÔ∏è';
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : 'info';
            logDiv.innerHTML += `<span class="${className}">[${timestamp}] ${prefix} ${message}</span>\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearLog() {
            document.getElementById('log').innerHTML = 'Log cleared...\n';
        }

        async function setupViaREST() {
            log('üöÄ Starting REST API setup...');

            const baseUrl = 'http://localhost:8080/v1/projects/damp-smart-drinkware/databases/(default)/documents';

            // Document 1: voting/productVoting
            const votingDoc = {
                fields: {
                    products: {
                        mapValue: {
                            fields: {
                                handle: {
                                    mapValue: {
                                        fields: {
                                            id: { stringValue: 'handle' },
                                            name: { stringValue: 'DAMP Handle v1.0' },
                                            description: { stringValue: 'Universal attachment for any drinkware' },
                                            image: { stringValue: '/assets/images/products/damp-handle/damp-handle.png' },
                                            votes: { integerValue: '0' },
                                            percentage: { integerValue: '0' }
                                        }
                                    }
                                },
                                siliconeBottom: {
                                    mapValue: {
                                        fields: {
                                            id: { stringValue: 'siliconeBottom' },
                                            name: { stringValue: 'Silicone Bottom v1.0' },
                                            description: { stringValue: 'Non-slip silicone base' },
                                            image: { stringValue: '/assets/images/products/silicone-bottom/silicone-bottom.png' },
                                            votes: { integerValue: '0' },
                                            percentage: { integerValue: '0' }
                                        }
                                    }
                                },
                                cupSleeve: {
                                    mapValue: {
                                        fields: {
                                            id: { stringValue: 'cupSleeve' },
                                            name: { stringValue: 'Cup Sleeve v1.0' },
                                            description: { stringValue: 'Adjustable fit for most cups' },
                                            image: { stringValue: '/assets/images/products/cup-sleeve/cup-sleeve.png' },
                                            votes: { integerValue: '0' },
                                            percentage: { integerValue: '0' }
                                        }
                                    }
                                },
                                babyBottle: {
                                    mapValue: {
                                        fields: {
                                            id: { stringValue: 'babyBottle' },
                                            name: { stringValue: 'Baby Bottle v1.0' },
                                            description: { stringValue: 'BPA-free smart bottle' },
                                            image: { stringValue: '/assets/images/products/baby-bottle/baby-bottle.png' },
                                            votes: { integerValue: '0' },
                                            percentage: { integerValue: '0' }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    settings: {
                        mapValue: {
                            fields: {
                                votingActive: { booleanValue: true },
                                publicVotingActive: { booleanValue: true },
                                maxVotesPerUser: { integerValue: '1' },
                                allowVoteChanging: { booleanValue: true }
                            }
                        }
                    },
                    metadata: {
                        mapValue: {
                            fields: {
                                totalVotes: { integerValue: '0' },
                                totalUsers: { integerValue: '0' },
                                totalPublicVotes: { integerValue: '0' }
                            }
                        }
                    }
                }
            };

            try {
                log('Creating voting/productVoting...');
                const response1 = await fetch(`${baseUrl}/voting?documentId=productVoting`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(votingDoc)
                });

                if (response1.ok) {
                    log('‚úÖ Created voting/productVoting', 'success');
                } else {
                    log(`‚ùå Failed voting/productVoting: ${response1.status} ${response1.statusText}`, 'error');
                }

                // Document 2: stats/global
                log('Creating stats/global...');
                const statsDoc = {
                    fields: {
                        totalVotes: { integerValue: '0' },
                        totalUsers: { integerValue: '0' },
                        totalPublicVotes: { integerValue: '0' },
                        products: {
                            mapValue: {
                                fields: {
                                    handle: {
                                        mapValue: {
                                            fields: {
                                                votes: { integerValue: '0' },
                                                percentage: { integerValue: '0' }
                                            }
                                        }
                                    },
                                    siliconeBottom: {
                                        mapValue: {
                                            fields: {
                                                votes: { integerValue: '0' },
                                                percentage: { integerValue: '0' }
                                            }
                                        }
                                    },
                                    cupSleeve: {
                                        mapValue: {
                                            fields: {
                                                votes: { integerValue: '0' },
                                                percentage: { integerValue: '0' }
                                            }
                                        }
                                    },
                                    babyBottle: {
                                        mapValue: {
                                            fields: {
                                                votes: { integerValue: '0' },
                                                percentage: { integerValue: '0' }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                };

                const response2 = await fetch(`${baseUrl}/stats?documentId=global`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(statsDoc)
                });

                if (response2.ok) {
                    log('‚úÖ Created stats/global', 'success');
                } else {
                    log(`‚ùå Failed stats/global: ${response2.status} ${response2.statusText}`, 'error');
                }

                log('üéâ Quick setup complete!', 'success');
                log('üìã Check Emulator UI: http://localhost:4000/firestore', 'info');
                log('üß™ Test Voting: http://localhost:5000/test-voting-system.html', 'info');

            } catch (error) {
                log(`‚ùå Setup failed: ${error.message}`, 'error');
            }
        }
    </script>
</body>
</html>