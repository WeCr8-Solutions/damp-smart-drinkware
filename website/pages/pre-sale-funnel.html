<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" content="#0f0f23">

    <!-- Enhanced Security Meta Tags -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://www.googletagmanager.com https://js.stripe.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; img-src 'self' data: https://www.googletagmanager.com; font-src 'self' https://fonts.gstatic.com;">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
    <meta http-equiv="Strict-Transport-Security" content="max-age=31536000; includeSubDomains">

    <!-- Favicon Links -->
    <link rel="icon" type="image/x-icon" href="../assets/images/logo/favicon.ico">
    <link rel="shortcut icon" type="image/x-icon" href="../assets/images/logo/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="../assets/images/logo/icon.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../assets/images/logo/icon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="../assets/images/logo/icon.png">

    <!-- Prevent PWA installation prompts -->
    <meta name="mobile-web-app-capable" content="no">
    <meta name="apple-mobile-web-app-capable" content="no">

    <!-- SEO Meta Tags - Pre-Sale Optimized -->
    <title>Pre-Order DAMP Smart Cup Accessory - Limited Early Access</title>
    <meta name="description" content="Turn your favorite cup smart with DAMP. Never lose your drink again. Pre-order now with exclusive early-bird pricing.">
    <meta name="keywords" content="smart cup accessory, pre-order, early access, never lose drink, clip-on tracker, Stanley, Hydro Flask, Yeti">
    <meta name="author" content="WeCr8 Solutions LLC">
    <meta name="robots" content="index, follow, max-image-preview:large">
    <link rel="canonical" href="https://dampdrink.com/pages/pre-sale-funnel.html">

    <!-- Open Graph -->
    <meta property="og:type" content="product">
    <meta property="og:url" content="https://dampdrink.com/pages/pre-sale-funnel.html">
    <meta property="og:title" content="Pre-Order DAMP Smart Cup Accessory">
    <meta property="og:description" content="Turn your favorite cup smart with DAMP. Pre-order with exclusive pricing.">
    <meta property="og:image" content="https://dampdrink.com/assets/images/og-presale.jpg">
    <meta property="og:site_name" content="DAMP Smart Drinkware">

    <!-- Preconnect to external domains -->
    <link rel="preconnect" href="https://www.googletagmanager.com">
    <link rel="preconnect" href="https://js.stripe.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">

    <!-- CSS Architecture -->
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="stylesheet" href="../assets/css/components/cookie-consent.css">

    <!-- Pre-Sale Specific Styles -->
    <style>
        /* Pre-Sale Funnel Specific Styles */
        :root {
            --presale-accent: #ff4757;
            --presale-success: #00ff88;
            --presale-warning: #ffa502;
            --urgency-pulse: #ff3838;
        }

        .presale-body {
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        .presale-hero {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 120px 20px 60px;
            position: relative;
            overflow: hidden;
        }

        .presale-hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 50% 50%, rgba(0, 212, 255, 0.1) 0%, transparent 50%);
            pointer-events: none;
        }

        .hero-content {
            max-width: 800px;
            margin: 0 auto;
            z-index: 2;
            position: relative;
        }

        .presale-badge {
            display: inline-block;
            background: linear-gradient(45deg, var(--presale-accent), #ff6b6b);
            color: white;
            padding: 8px 20px;
            border-radius: 25px;
            font-size: 0.9rem;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 20px;
            animation: pulse 2s infinite;
        }

        .hero-title {
            font-size: clamp(2.5rem, 8vw, 4rem);
            font-weight: 900;
            background: linear-gradient(45deg, #ffffff, #00d4ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 20px;
            line-height: 1.1;
        }

        .hero-subtitle {
            font-size: clamp(1.1rem, 3vw, 1.4rem);
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 40px;
            line-height: 1.4;
        }

        .goal-counter {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            margin: 40px 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .counter-title {
            font-size: 1.2rem;
            color: var(--presale-success);
            font-weight: bold;
            margin-bottom: 15px;
        }

        .progress-container {
            margin: 20px 0;
        }

        .progress-numbers {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .current-count {
            font-size: 2rem;
            font-weight: bold;
            color: var(--presale-success);
        }

        .goal-count {
            font-size: 1.2rem;
            color: rgba(255, 255, 255, 0.7);
        }

        .progress-bar-container {
            width: 100%;
            height: 12px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--presale-success), #00d4ff);
            border-radius: 6px;
            transition: width 1s ease;
            position: relative;
        }

        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 2s infinite;
        }

        .countdown-timer {
            background: linear-gradient(45deg, var(--presale-accent), #ff6b6b);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            text-align: center;
        }

        .countdown-label {
            font-size: 0.9rem;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
            opacity: 0.9;
        }

        .countdown-display {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .countdown-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 60px;
        }

        .countdown-number {
            font-size: 1.8rem;
            font-weight: bold;
            line-height: 1;
        }

        .countdown-unit {
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            opacity: 0.8;
        }

        .cta-primary {
            display: inline-block;
            background: linear-gradient(45deg, #00d4ff, #0099cc);
            color: white;
            padding: 18px 40px;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: bold;
            text-decoration: none;
            transition: all 0.3s ease;
            margin: 20px 0;
            box-shadow: 0 8px 25px rgba(0, 212, 255, 0.3);
        }

        .cta-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(0, 212, 255, 0.4);
        }

        .problem-solution {
            padding: 100px 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .section-title {
            font-size: clamp(2rem, 5vw, 3rem);
            text-align: center;
            background: linear-gradient(45deg, #ffffff, #00d4ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 60px;
            font-weight: bold;
        }

        .problem-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 40px;
            margin-bottom: 80px;
        }

        .problem-card, .solution-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 40px 30px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .problem-card {
            border-left: 4px solid var(--presale-accent);
        }

        .solution-card {
            border-left: 4px solid var(--presale-success);
        }

        .problem-card:hover, .solution-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .card-icon {
            font-size: 3rem;
            margin-bottom: 20px;
            display: block;
        }

        .card-title {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: #ffffff;
        }

        .card-description {
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.6;
        }

        .how-it-works {
            padding: 100px 20px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
        }

        .steps-container {
            max-width: 1000px;
            margin: 0 auto;
        }

        .steps-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 40px;
            margin-top: 60px;
        }

        .step-card {
            text-align: center;
            position: relative;
        }

        .step-number {
            width: 60px;
            height: 60px;
            background: linear-gradient(45deg, #00d4ff, #0099cc);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            margin: 0 auto 20px;
            color: white;
        }

        .step-title {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: #00d4ff;
        }

        .step-description {
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.6;
        }

        .social-proof {
            padding: 100px 20px;
            max-width: 1200px;
            margin: 0 auto;
            text-align: center;
        }

        .final-cta {
            padding: 100px 20px;
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.1), rgba(255, 71, 87, 0.1));
            text-align: center;
        }

        .cta-container {
            max-width: 600px;
            margin: 0 auto;
        }

        .recent-activity {
            background: rgba(0, 255, 136, 0.2);
            border: 1px solid var(--presale-success);
            border-radius: 10px;
            padding: 15px;
            margin: 30px 0;
            font-size: 0.9rem;
            color: var(--presale-success);
            font-weight: bold;
        }

        .live-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: var(--presale-success);
            border-radius: 50%;
            margin-right: 8px;
            animation: blink 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        /* Product card hover effects */
        .product-card {
            transition: all 0.3s ease;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        /* Button hover effects */
        .qty-btn:hover, .add-to-cart-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0, 212, 255, 0.3);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .presale-hero {
                padding: 100px 15px 40px;
            }

            .goal-counter {
                padding: 20px;
                margin: 30px 0;
            }

            .progress-numbers {
                flex-direction: column;
                gap: 10px;
            }

            .countdown-display {
                gap: 10px;
            }

            .countdown-item {
                min-width: 50px;
            }

            .problem-solution, .how-it-works, .social-proof, .final-cta {
                padding: 60px 15px;
            }

            .cta-primary {
                padding: 15px 30px;
                font-size: 1.1rem;
            }
        }
    </style>

    <!-- Security Scripts -->
    <script src="../assets/js/security-utils.js"></script>

    <!-- Analytics -->
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('consent', 'default', {
            'analytics_storage': 'denied',
            'ad_storage': 'denied',
            'functionality_storage': 'denied',
            'personalization_storage': 'denied',
            'security_storage': 'granted'
        });
        gtag('js', new Date());
        gtag('config', 'GA_MEASUREMENT_ID', {
            page_title: 'DAMP Pre-Sale Funnel',
            send_page_view: false
        });
    </script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script>

    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">

    <!-- PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="DAMP">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="msapplication-TileColor" content="#1a1a2e">
    <meta name="msapplication-tap-highlight" content="no">

    <!-- PWA Theme Colors -->
    <meta name="theme-color" content="#00d4ff" media="(prefers-color-scheme: light)">
    <meta name="theme-color" content="#1a1a2e" media="(prefers-color-scheme: dark)">

    <!-- PWA Icons -->
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/images/logo/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/images/logo/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="48x48" href="/assets/images/logo/icon-48.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/assets/images/logo/icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/assets/images/logo/icon-512.png">

    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" sizes="57x57" href="/assets/images/logo/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/assets/images/logo/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/assets/images/logo/icon-72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/assets/images/logo/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/assets/images/logo/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/assets/images/logo/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/assets/images/logo/icon-144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/assets/images/logo/icon-152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/images/logo/apple-icon-180x180.png"></head>

<body class="presale-body">
    <!-- Navigation Header -->
    <damp-header></damp-header>

    <!-- Hero Section with Goal Counter -->
    <section class="presale-hero" id="main-content">
        <div class="hero-content">
            <div class="presale-badge">
                ðŸš€ PRE-SALE NOW LIVE
            </div>

            <h1 class="hero-title">
                Turn Your Favorite Cup Smart â€“ Never Lose It Again
            </h1>

            <p class="hero-subtitle">
                Clip-on accessory for Stanley, Hydro Flask, and more â€“ Pre-order today and reserve your spot.
            </p>

            <!-- Live Goal Counter -->
            <div class="goal-counter">
                <div class="counter-title">
                    <span class="live-indicator"></span>
                    <span id="current-backers"></span> of 500 Pre-Orders Reserved
                </div>

                <div class="progress-container">
                    <div class="progress-numbers">
                        <span class="current-count" id="progress-count"></span>
                        <span class="goal-count">/ 500 Goal</span>
                    </div>

                    <div class="progress-bar-container">
                        <div class="progress-bar" id="progress-bar" style="width: 0"></div>
                    </div>
                </div>

                <!-- Countdown Timer -->
                <div class="countdown-timer">
                    <div class="countdown-label">Early Bird Pricing Closes In:</div>
                    <div class="countdown-display">
                        <div class="countdown-item">
                            <span class="countdown-number" id="days">6</span>
                            <span class="countdown-unit">Days</span>
                        </div>
                        <div class="countdown-item">
                            <span class="countdown-number" id="hours">14</span>
                            <span class="countdown-unit">Hours</span>
                        </div>
                        <div class="countdown-item">
                            <span class="countdown-number" id="minutes">37</span>
                            <span class="countdown-unit">Minutes</span>
                        </div>
                        <div class="countdown-item">
                            <span class="countdown-number" id="seconds">28</span>
                            <span class="countdown-unit">Seconds</span>
                        </div>
                    </div>
                </div>
            </div>

            <a href="#checkout" class="cta-primary" data-analytics="hero-cta">
                Pre-Order Now
            </a>

            <div class="recent-activity">
                <span class="live-indicator"></span>
                <span id="recent-activity-text">3 people pre-ordered in the last hour</span>
            </div>
        </div>
    </section>

    <!-- Problem & Solution Section -->
    <section class="problem-solution">
        <h2 class="section-title">The Problem We're Solving</h2>

        <div class="problem-grid">
            <div class="problem-card">
                <span class="card-icon">ðŸ˜«</span>
                <h3 class="card-title">You Keep Losing Your Drinks</h3>
                <p class="card-description">
                    Left your Stanley at the coffee shop? Forgot your Hydro Flask at the gym?
                    We've all been there â€“ expensive drinks abandoned everywhere.
                </p>
            </div>

            <div class="solution-card">
                <span class="card-icon">ðŸ“±</span>
                <h3 class="card-title">Smart Phone Alerts</h3>
                <p class="card-description">
                    DAMP clips onto any cup and alerts your phone when you're about to leave it behind.
                    Works with Stanley, Hydro Flask, Yeti, and more.
                </p>
            </div>
        </div>

        <div style="text-align: center; margin-top: 40px;">
            <p style="font-size: 1.2rem; color: rgba(255, 255, 255, 0.9);">
                <strong>Works with Stanley, Hydro Flask, Yeti, and virtually any cup or bottle</strong>
            </p>
        </div>
    </section>

    <!-- How It Works Section -->
    <section class="how-it-works">
        <div class="steps-container">
            <h2 class="section-title">How DAMP Works</h2>
            <p style="text-align: center; font-size: 1.2rem; color: rgba(255, 255, 255, 0.8); margin-bottom: 40px;">
                Three simple steps to never lose your drink again
            </p>

            <div class="steps-grid">
                <div class="step-card">
                    <div class="step-number">1</div>
                    <h3 class="step-title">Clip DAMP Onto Your Cup</h3>
                    <p class="step-description">
                        Universal clip design works with Stanley tumblers, Hydro Flask bottles,
                        Yeti mugs, and virtually any drinkware. Installs in seconds.
                    </p>
                </div>

                <div class="step-card">
                    <div class="step-number">2</div>
                    <h3 class="step-title">Pair With Phone Via App</h3>
                    <p class="step-description">
                        Download the DAMP app and pair your device via Bluetooth.
                        Simple one-time setup works with iOS and Android.
                    </p>
                </div>

                <div class="step-card">
                    <div class="step-number">3</div>
                    <h3 class="step-title">Get Notified Before You Lose It</h3>
                    <p class="step-description">
                        Walk away from your drink? Get an instant alert on your phone
                        before you leave it behind. Never lose another cup.
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- Social Proof Section Removed -->

    <!-- Product Selection & Cart Section -->
    <section class="final-cta" id="checkout">
        <div class="cta-container">
            <h2 class="section-title">Choose Your DAMP Products</h2>

            <p style="font-size: 1.2rem; color: rgba(255, 255, 255, 0.9); margin-bottom: 30px;">
                Select your products and quantities to reserve your spot.
            </p>

            <!-- Product Selection Grid -->
            <div class="product-selection-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin: 40px 0;">

                <!-- DAMP Silicone Bottom -->
                <div class="product-card" data-product-id="silicone-bottom">
                    <div class="product-image" style="height: 200px; background: linear-gradient(135deg, #00d4ff, #0099cc); border-radius: 15px; display: flex; align-items: center; justify-content: center; margin-bottom: 15px; padding: 20px;">
                        <img src="../assets/images/products/silicone-bottom/silicone-bottom.png" alt="DAMP Silicone Bottom" style="max-width: 100%; max-height: 100%; object-fit: contain; filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));">
                    </div>
                    <h3 class="product-title" style="color: white; font-size: 1.3rem; font-weight: bold; margin-bottom: 10px;">DAMP Silicone Bottom</h3>
                    <div class="product-pricing" style="margin-bottom: 15px;">
                        <span class="current-price" style="color: var(--presale-success); font-size: 1.4rem; font-weight: bold;">$29.99</span>
                        <span class="original-price" style="color: rgba(255,255,255,0.6); text-decoration: line-through; margin-left: 10px;">$39.99</span>
                    </div>
                    <p class="product-description" style="color: rgba(255,255,255,0.8); font-size: 0.9rem; margin-bottom: 20px;">Smart temperature monitoring silicone bottom for any cup or bottle.</p>

                    <div class="quantity-controls" style="display: flex; align-items: center; justify-content: center; gap: 15px; margin-bottom: 15px;">
                        <button class="qty-btn minus" data-product="silicone-bottom" style="width: 40px; height: 40px; border: none; background: rgba(255,255,255,0.2); color: white; border-radius: 50%; cursor: pointer; font-size: 1.2rem;">-</button>
                        <span class="quantity" data-product="silicone-bottom" style="color: white; font-size: 1.2rem; font-weight: bold; min-width: 30px; text-align: center;">0</span>
                        <button class="qty-btn plus" data-product="silicone-bottom" style="width: 40px; height: 40px; border: none; background: rgba(255,255,255,0.2); color: white; border-radius: 50%; cursor: pointer; font-size: 1.2rem;">+</button>
                    </div>

                    <button class="add-to-cart-btn" data-product-id="silicone-bottom" data-product-name="DAMP Silicone Bottom" data-product-price="29.99" style="width: 100%; background: linear-gradient(45deg, var(--presale-success), #00d4ff); color: white; border: none; padding: 12px; border-radius: 25px; font-weight: bold; cursor: pointer; transition: all 0.3s ease;">
                        Add to Cart
                    </button>
                </div>

                <!-- DAMP Handle v1.0 -->
                <div class="product-card" data-product-id="damp-handle">
                    <div class="product-image" style="height: 200px; background: linear-gradient(135deg, #ff4757, #ff6b6b); border-radius: 15px; display: flex; align-items: center; justify-content: center; margin-bottom: 15px; padding: 20px;">
                        <img src="../assets/images/products/damp-handle/damp-handle.png" alt="DAMP Handle v1.0" style="max-width: 100%; max-height: 100%; object-fit: contain; filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));">
                    </div>
                    <h3 class="product-title" style="color: white; font-size: 1.3rem; font-weight: bold; margin-bottom: 10px;">DAMP Handle v1.0</h3>
                    <div class="product-pricing" style="margin-bottom: 15px;">
                        <span class="current-price" style="color: var(--presale-success); font-size: 1.4rem; font-weight: bold;">$49.99</span>
                        <span class="original-price" style="color: rgba(255,255,255,0.6); text-decoration: line-through; margin-left: 10px;">$69.99</span>
                    </div>
                    <p class="product-description" style="color: rgba(255,255,255,0.8); font-size: 0.9rem; margin-bottom: 20px;">Smart handle attachment for Stanley IceFlow and similar bottles.</p>

                    <div class="quantity-controls" style="display: flex; align-items: center; justify-content: center; gap: 15px; margin-bottom: 15px;">
                        <button class="qty-btn minus" data-product="damp-handle" style="width: 40px; height: 40px; border: none; background: rgba(255,255,255,0.2); color: white; border-radius: 50%; cursor: pointer; font-size: 1.2rem;">-</button>
                        <span class="quantity" data-product="damp-handle" style="color: white; font-size: 1.2rem; font-weight: bold; min-width: 30px; text-align: center;">0</span>
                        <button class="qty-btn plus" data-product="damp-handle" style="width: 40px; height: 40px; border: none; background: rgba(255,255,255,0.2); color: white; border-radius: 50%; cursor: pointer; font-size: 1.2rem;">+</button>
                    </div>

                    <button class="add-to-cart-btn" data-product-id="damp-handle" data-product-name="DAMP Handle v1.0" data-product-price="49.99" style="width: 100%; background: linear-gradient(45deg, var(--presale-success), #00d4ff); color: white; border: none; padding: 12px; border-radius: 25px; font-weight: bold; cursor: pointer; transition: all 0.3s ease;">
                        Add to Cart
                    </button>
                </div>

                <!-- DAMP Cup Sleeve -->
                <div class="product-card" data-product-id="cup-sleeve">
                    <div class="product-image" style="height: 200px; background: linear-gradient(135deg, #ffa502, #ff6348); border-radius: 15px; display: flex; align-items: center; justify-content: center; margin-bottom: 15px; padding: 20px;">
                        <img src="../assets/images/products/cup-sleeve/cup-sleeve.png" alt="DAMP Cup Sleeve" style="max-width: 100%; max-height: 100%; object-fit: contain; filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));">
                    </div>
                    <h3 class="product-title" style="color: white; font-size: 1.3rem; font-weight: bold; margin-bottom: 10px;">DAMP Cup Sleeve</h3>
                    <div class="product-pricing" style="margin-bottom: 15px;">
                        <span class="current-price" style="color: var(--presale-success); font-size: 1.4rem; font-weight: bold;">$34.99</span>
                        <span class="original-price" style="color: rgba(255,255,255,0.6); text-decoration: line-through; margin-left: 10px;">$44.99</span>
                    </div>
                    <p class="product-description" style="color: rgba(255,255,255,0.8); font-size: 0.9rem; margin-bottom: 20px;">Smart sleeve for coffee cups and smaller drinkware.</p>

                    <div class="quantity-controls" style="display: flex; align-items: center; justify-content: center; gap: 15px; margin-bottom: 15px;">
                        <button class="qty-btn minus" data-product="cup-sleeve" style="width: 40px; height: 40px; border: none; background: rgba(255,255,255,0.2); color: white; border-radius: 50%; cursor: pointer; font-size: 1.2rem;">-</button>
                        <span class="quantity" data-product="cup-sleeve" style="color: white; font-size: 1.2rem; font-weight: bold; min-width: 30px; text-align: center;">0</span>
                        <button class="qty-btn plus" data-product="cup-sleeve" style="width: 40px; height: 40px; border: none; background: rgba(255,255,255,0.2); color: white; border-radius: 50%; cursor: pointer; font-size: 1.2rem;">+</button>
                    </div>

                    <button class="add-to-cart-btn" data-product-id="cup-sleeve" data-product-name="DAMP Cup Sleeve" data-product-price="34.99" style="width: 100%; background: linear-gradient(45deg, var(--presale-success), #00d4ff); color: white; border: none; padding: 12px; border-radius: 25px; font-weight: bold; cursor: pointer; transition: all 0.3s ease;">
                        Add to Cart
                    </button>
                </div>

                <!-- DAMP Baby Bottle -->
                <div class="product-card" data-product-id="baby-bottle">
                    <div class="product-image" style="height: 200px; background: linear-gradient(135deg, #a55eea, #fd79a8); border-radius: 15px; display: flex; align-items: center; justify-content: center; margin-bottom: 15px; padding: 20px;">
                        <img src="../assets/images/products/baby-bottle/baby-bottle.png" alt="DAMP Baby Bottle" style="max-width: 100%; max-height: 100%; object-fit: contain; filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));">
                    </div>
                    <h3 class="product-title" style="color: white; font-size: 1.3rem; font-weight: bold; margin-bottom: 10px;">DAMP Baby Bottle</h3>
                    <div class="product-pricing" style="margin-bottom: 15px;">
                        <span class="current-price" style="color: var(--presale-success); font-size: 1.4rem; font-weight: bold;">$79.99</span>
                        <span class="original-price" style="color: rgba(255,255,255,0.6); text-decoration: line-through; margin-left: 10px;">$99.99</span>
                    </div>
                    <p class="product-description" style="color: rgba(255,255,255,0.8); font-size: 0.9rem; margin-bottom: 20px;">Smart baby bottle with temperature monitoring and alerts.</p>

                    <div class="quantity-controls" style="display: flex; align-items: center; justify-content: center; gap: 15px; margin-bottom: 15px;">
                        <button class="qty-btn minus" data-product="baby-bottle" style="width: 40px; height: 40px; border: none; background: rgba(255,255,255,0.2); color: white; border-radius: 50%; cursor: pointer; font-size: 1.2rem;">-</button>
                        <span class="quantity" data-product="baby-bottle" style="color: white; font-size: 1.2rem; font-weight: bold; min-width: 30px; text-align: center;">0</span>
                        <button class="qty-btn plus" data-product="baby-bottle" style="width: 40px; height: 40px; border: none; background: rgba(255,255,255,0.2); color: white; border-radius: 50%; cursor: pointer; font-size: 1.2rem;">+</button>
                    </div>

                    <button class="add-to-cart-btn" data-product-id="baby-bottle" data-product-name="DAMP Baby Bottle" data-product-price="79.99" style="width: 100%; background: linear-gradient(45deg, var(--presale-success), #00d4ff); color: white; border: none; padding: 12px; border-radius: 25px; font-weight: bold; cursor: pointer; transition: all 0.3s ease;">
                        Add to Cart
                    </button>
                </div>
            </div>

            <!-- Cart Summary -->
            <div class="cart-summary" id="cart-summary" style="background: rgba(255,255,255,0.1); backdrop-filter: blur(20px); border-radius: 20px; padding: 30px; margin: 40px 0; border: 1px solid rgba(255,255,255,0.2); display: none;">
                <h3 style="color: white; font-size: 1.4rem; font-weight: bold; margin-bottom: 20px; text-align: center;">ðŸ›’ Your Cart</h3>
                <div id="cart-items" style="margin-bottom: 20px;"></div>
                <div class="cart-total" style="border-top: 1px solid rgba(255,255,255,0.3); padding-top: 15px; text-align: center;">
                    <div style="color: rgba(255,255,255,0.8); margin-bottom: 5px;">
                        Items: <span id="cart-item-count">0</span>
                    </div>
                    <div style="color: var(--presale-success); font-size: 1.6rem; font-weight: bold;">
                        Total: $<span id="cart-total">0.00</span>
                    </div>
                    <div style="color: rgba(255,255,255,0.6); font-size: 0.9rem; margin-top: 5px;">
                        You save: $<span id="cart-savings">0.00</span>
                    </div>
                </div>
            </div>

            <!-- Repeated Goal Counter for Double Push -->
            <div class="goal-counter">
                <div class="progress-container">
                    <div class="progress-numbers">
                        <span class="current-count" id="final-progress-count">326</span>
                        <span class="goal-count">/ 500 Limited Edition</span>
                    </div>

                    <div class="progress-bar-container">
                        <div class="progress-bar" id="final-progress-bar" style="width: 65.2%"></div>
                    </div>
                </div>
            </div>

            <button class="cta-primary" data-analytics="final-cta" id="checkout-button" style="opacity: 0.5; cursor: not-allowed;" disabled>
                Add Items to Cart First
            </button>

            <p style="font-size: 0.9rem; color: rgba(255, 255, 255, 0.7); margin-top: 20px;">
                ðŸ”’ Secure payment via Stripe â€¢ 30-day money-back guarantee<br>
                ðŸ’³ All major cards accepted â€¢ Free worldwide shipping
            </p>

            <div class="recent-activity" style="margin-top: 30px;">
                <span class="live-indicator"></span>
                <span id="final-activity-text">Last order: 23 minutes ago from Austin, TX</span>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer" style="background: rgba(0, 0, 0, 0.5); padding: 40px 20px; text-align: center;">
        <div style="max-width: 800px; margin: 0 auto;">
            <p style="color: rgba(255, 255, 255, 0.7); margin-bottom: 20px;">
                Questions about your pre-order? Email us at
                <a href="mailto:support@dampdrink.com" style="color: var(--presale-success);">support@dampdrink.com</a>
            </p>

            <div style="display: flex; justify-content: center; gap: 30px; flex-wrap: wrap; margin-bottom: 20px;">
                <a href="../pages/privacy.html" style="color: rgba(255, 255, 255, 0.6); text-decoration: none;">Privacy Policy</a>
                <a href="../pages/support.html" style="color: rgba(255, 255, 255, 0.6); text-decoration: none;">Support</a>
                <a href="../pages/about.html" style="color: rgba(255, 255, 255, 0.6); text-decoration: none;">About Us</a>
            </div>

            <p style="color: rgba(255, 255, 255, 0.5); font-size: 0.9rem;">
                &copy; 2025 WeCr8 Solutions LLC. All rights reserved.
            </p>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="../assets/js/components/safe-area-wrapper.js"></script>
    <script src="../assets/js/components/header.js"></script>
    <script src="../assets/js/auth-modal.js"></script>

    <!-- Stripe JavaScript SDK -->
    <script src="https://js.stripe.com/v3/"></script>

    <!-- Pre-Sale Funnel JavaScript -->
    <script>
        // Pre-Sale Funnel Controller
        class PreSaleFunnel {
            constructor() {
                this.currentCount = 326; // Starting count
                this.goalCount = 500;
                this.countdownEndTime = new Date();
                this.countdownEndTime.setDate(this.countdownEndTime.getDate() + 7); // 7 days from now

                // Cart functionality
                this.cart = {};
                this.products = {
                    'silicone-bottom': { name: 'DAMP Silicone Bottom', price: 29.99, originalPrice: 39.99 },
                    'damp-handle': { name: 'DAMP Handle v1.0', price: 49.99, originalPrice: 69.99 },
                    'cup-sleeve': { name: 'DAMP Cup Sleeve', price: 34.99, originalPrice: 44.99 },
                    'baby-bottle': { name: 'DAMP Baby Bottle', price: 79.99, originalPrice: 99.99 }
                };

                this.init();
            }

            init() {
                this.updateCounters();
                this.startCountdown();
                this.startRealtimeUpdates();
                this.setupAnalytics();
                this.startLiveActivityUpdates(); // Use live data instead of simulated
                this.setupCartFunctionality();

                // Setup checkout button
                document.getElementById('checkout-button').addEventListener('click', (e) => {
                    e.preventDefault();
                    this.initiateCheckout();
                });
            }

                // Setup checkout button (handled in init, no need to duplicate)

            setupCartFunctionality() {
                // Quantity controls
                document.querySelectorAll('.qty-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.preventDefault();
                        const productId = btn.dataset.product;
                        const isPlus = btn.classList.contains('plus');
                        this.updateQuantity(productId, isPlus ? 1 : -1);
                    });
                });

                // Add to cart buttons
                document.querySelectorAll('.add-to-cart-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.preventDefault();
                        const productId = btn.dataset.productId;
                        const quantityEl = document.querySelector(`[data-product="${productId}"].quantity`);
                        let quantity = 0;
                        if (quantityEl) {
                            quantity = parseInt(quantityEl.textContent, 10) || 0;
                        }
                        // Only allow adding if quantity > 0
                        if (quantity > 0) {
                            this.addToCart(productId, quantity);
                        }
                    });
                });
            }

            updateQuantity(productId, change) {
                const quantityEl = document.querySelector(`[data-product="${productId}"].quantity`);
                if (!quantityEl) {
                    console.error('âŒ Quantity element not found for:', productId);
                    return;
                }

                const currentQty = parseInt(quantityEl.textContent, 10) || 0;
                const newQty = Math.max(0, Math.min(10, currentQty + change)); // Limit 0-10

                quantityEl.textContent = newQty;

                // Update add to cart button state
                const addBtn = document.querySelector(`[data-product-id="${productId}"]`);
                if (!addBtn) {
                    return;
                }

                if (newQty > 0) {
                    addBtn.style.opacity = '1';
                    addBtn.style.cursor = 'pointer';
                    addBtn.textContent = `Add ${newQty} to Cart`;
                    addBtn.disabled = false;
                } else {
                    addBtn.style.opacity = '0.7';
                    addBtn.style.cursor = 'not-allowed';
                    addBtn.textContent = 'Add to Cart';
                    addBtn.disabled = true;
                }

                // Update checkout button state
                this.updateCheckoutButton();
            }

            updateCheckoutButton() {
                const checkoutBtn = document.getElementById('checkout-button');
                if (!checkoutBtn) return;

                // Check if there are any items with quantity > 0 OR items in cart
                const hasQuantitySelected = Array.from(document.querySelectorAll('.quantity')).some(el => parseInt(el.textContent, 10) > 0);
                const hasItemsInCart = Object.keys(this.cart).length > 0;

                if (hasQuantitySelected || hasItemsInCart) {
                    checkoutBtn.disabled = false;
                    checkoutBtn.style.opacity = '1';
                    checkoutBtn.style.cursor = 'pointer';

                    if (hasItemsInCart) {
                        const total = Object.entries(this.cart).reduce((sum, [productId, quantity]) => {
                            return sum + (this.products[productId].price * quantity);
                        }, 0);
                        checkoutBtn.textContent = `Checkout - $${total.toFixed(2)}`;
                    } else {
                        checkoutBtn.textContent = 'Add Items to Cart First';
                    }
                } else {
                    checkoutBtn.disabled = true;
                    checkoutBtn.style.opacity = '0.5';
                    checkoutBtn.style.cursor = 'not-allowed';
                    checkoutBtn.textContent = 'Add Items to Cart First';
                }
            }

            addToCart(productId, quantity) {
                if (quantity <= 0) return;

                // Add to cart object
                if (this.cart[productId]) {
                    this.cart[productId] += quantity;
                } else {
                    this.cart[productId] = quantity;
                }

                // Reset quantity display but keep button functional
                const quantityEl = document.querySelector(`[data-product="${productId}"].quantity`);
                if (quantityEl) quantityEl.textContent = '0';
                const addBtn = document.querySelector(`[data-product-id="${productId}"]`);

                // Keep button enabled and functional (don't disable it)
                if (addBtn) {
                    addBtn.style.opacity = '1';
                    addBtn.style.cursor = 'pointer';
                    addBtn.textContent = 'Add More to Cart';
                }

                // Update cart display
                this.updateCartDisplay();

                // Update checkout button
                this.updateCheckoutButton();

                // Show success message
                const productName = this.products[productId].name;
                this.showCartMessage(`âœ… Added ${quantity}x ${productName} to cart!`);

                // Track analytics
                this.trackAnalytics('add_to_cart', {
                    product_id: productId,
                    quantity: quantity,
                    product_name: productName
                });
            }

            removeFromCart(productId, quantityToRemove = null) {
                if (!this.cart[productId]) return;

                if (quantityToRemove === null || quantityToRemove >= this.cart[productId]) {
                    delete this.cart[productId];
                } else {
                    this.cart[productId] -= quantityToRemove;
                }

                this.updateCartDisplay();
                this.updateCheckoutButton();
            }

            updateCartDisplay() {
                const cartSummary = document.getElementById('cart-summary');
                const cartItems = document.getElementById('cart-items');
                const cartItemCount = document.getElementById('cart-item-count');
                const cartTotal = document.getElementById('cart-total');
                const cartSavings = document.getElementById('cart-savings');
                const checkoutBtn = document.getElementById('checkout-button');

                // Check if cart is empty
                const totalItems = Object.values(this.cart).reduce((sum, qty) => sum + qty, 0);

                if (totalItems === 0) {
                    if (cartSummary) cartSummary.style.display = 'none';
                    if (checkoutBtn) {
                        checkoutBtn.disabled = true;
                        checkoutBtn.style.opacity = '0.5';
                        checkoutBtn.style.cursor = 'not-allowed';
                        checkoutBtn.textContent = 'Add Items to Cart First';
                    }
                    return;
                }

                // Show cart summary
                if (cartSummary) cartSummary.style.display = 'block';

                // Build cart items HTML
                let itemsHTML = '';
                let total = 0;
                let totalSavings = 0;

                Object.entries(this.cart).forEach(([productId, quantity]) => {
                    const product = this.products[productId];
                    const itemTotal = product.price * quantity;
                    const itemSavings = (product.originalPrice - product.price) * quantity;

                    total += itemTotal;
                    totalSavings += itemSavings;

                    itemsHTML += `
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.1);">
                            <div style="flex: 1;">
                                <div style="color: white; font-weight: bold;">${product.name}</div>
                                <div style="color: rgba(255,255,255,0.7); font-size: 0.9rem;">$${product.price.toFixed(2)} each</div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <button class="cart-qty-btn" onclick="preSaleFunnel.removeFromCart('${productId}', 1)" style="width: 30px; height: 30px; border: none; background: rgba(255,255,255,0.2); color: white; border-radius: 50%; cursor: pointer;">-</button>
                                <span style="color: white; font-weight: bold; min-width: 20px; text-align: center;">${quantity}</span>
                                <button class="cart-qty-btn" onclick="preSaleFunnel.addToCart('${productId}', 1)" style="width: 30px; height: 30px; border: none; background: rgba(255,255,255,0.2); color: white; border-radius: 50%; cursor: pointer;">+</button>
                                <button onclick="preSaleFunnel.removeFromCart('${productId}')" style="background: rgba(255,71,87,0.3); color: #ff4757; border: none; padding: 5px 10px; border-radius: 15px; cursor: pointer; font-size: 0.8rem; margin-left: 10px;">Remove</button>
                            </div>
                            <div style="color: var(--presale-success); font-weight: bold; min-width: 80px; text-align: right;">
                                $${itemTotal.toFixed(2)}
                            </div>
                        </div>
                    `;
                });

                if (cartItems) cartItems.innerHTML = itemsHTML;
                if (cartItemCount) cartItemCount.textContent = totalItems;
                if (cartTotal) cartTotal.textContent = total.toFixed(2);
                if (cartSavings) cartSavings.textContent = totalSavings.toFixed(2);

                // Enable checkout button
                if (checkoutBtn) {
                    checkoutBtn.disabled = false;
                    checkoutBtn.style.opacity = '1';
                    checkoutBtn.style.cursor = 'pointer';
                    checkoutBtn.textContent = `Checkout - $${total.toFixed(2)} (Save $${totalSavings.toFixed(2)})`;
                }
            }

            showCartMessage(message) {
                // Create and show a temporary success message
                const messageEl = document.createElement('div');
                messageEl.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: linear-gradient(45deg, var(--presale-success), #00d4ff);
                    color: white;
                    padding: 15px 25px;
                    border-radius: 10px;
                    font-weight: bold;
                    z-index: 10000;
                    animation: slideInRight 0.3s ease;
                `;
                messageEl.textContent = message;
                document.body.appendChild(messageEl);

                // Remove after 3 seconds
                setTimeout(() => {
                    messageEl.style.animation = 'slideOutRight 0.3s ease';
                    setTimeout(() => messageEl.remove(), 300);
                }, 3000);
            }

            updateCounters() {
                const percentage = (this.currentCount / this.goalCount) * 100;

                // Update all counter displays
                document.getElementById('current-backers').textContent = this.currentCount;
                document.getElementById('progress-count').textContent = this.currentCount;
                document.getElementById('final-count').textContent = this.currentCount;
                document.getElementById('final-progress-count').textContent = this.currentCount;

                // Update progress bars
                document.getElementById('progress-bar').style.width = percentage + '%';
                document.getElementById('final-progress-bar').style.width = percentage + '%';

                // Add urgency messaging based on progress
                if (percentage > 90) {
                    this.addUrgencyMessage("ðŸ”¥ Almost sold out! Only " + (this.goalCount - this.currentCount) + " spots left!");
                } else if (percentage > 80) {
                    this.addUrgencyMessage("âš¡ Less than " + Math.ceil((this.goalCount - this.currentCount) / 10) * 10 + " spots remaining!");
                }
            }

            startCountdown() {
                const updateCountdown = () => {
                    const now = new Date().getTime();
                    const distance = this.countdownEndTime.getTime() - now;

                    if (distance < 0) {
                        this.handleCountdownExpired();
                        return;
                    }

                    const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((distance % (1000 * 60)) / 1000);

                    document.getElementById('days').textContent = days;
                    document.getElementById('hours').textContent = hours;
                    document.getElementById('minutes').textContent = minutes;
                    document.getElementById('seconds').textContent = seconds;

                    // Add urgency styling when time is low
                    if (days === 0 && hours < 24) {
                        document.querySelector('.countdown-timer').style.animation = 'pulse 1s infinite';
                    }
                };

                updateCountdown();
                setInterval(updateCountdown, 1000);
            }

            startRealtimeUpdates() {
                // Simulate realistic pre-order activity
                setInterval(() => {
                    // Randomly increase count (simulate real orders)
                    if (Math.random() < 0.3 && this.currentCount < this.goalCount) { // 30% chance every 30 seconds
                        this.currentCount += Math.floor(Math.random() * 2) + 1; // Add 1-2 orders
                        this.updateCounters();
                        this.trackAnalytics('simulated_order', { new_count: this.currentCount });
                    }
                }, 30000); // Every 30 seconds
            }

            async loadLiveActivity() {
                try {
                    const response = await fetch('/api/recent-activity');
                    if (!response.ok) {
                        throw new Error('Failed to fetch recent activity');
                    }

                    const data = await response.json();

                    // Update activity text
                    const activityText = data.activity;
                    document.getElementById('recent-activity-text').textContent = activityText;
                    document.getElementById('final-activity-text').textContent = activityText;

                    // Update current count if different
                    if (data.currentCount && data.currentCount !== this.currentCount) {
                        this.currentCount = data.currentCount;
                        this.updateCounters();
                    }

                    console.log('âœ… Live activity updated:', activityText);

                } catch (error) {
                    console.error('Error loading live activity:', error);
                    // Fallback to showing a generic message
                    const fallbackMessage = "Join our growing community!";
                    document.getElementById('recent-activity-text').textContent = fallbackMessage;
                    document.getElementById('final-activity-text').textContent = fallbackMessage;
                }
            }

            startLiveActivityUpdates() {
                // Load initial activity
                this.loadLiveActivity();

                // Update every 30 seconds with real data
                setInterval(() => {
                    this.loadLiveActivity();
                }, 30000);
            }

            addUrgencyMessage(message) {
                const urgencyEl = document.querySelector('.urgency-message');
                if (urgencyEl) {
                    urgencyEl.textContent = message;
                } else {
                    const newUrgency = document.createElement('div');
                    newUrgency.className = 'urgency-message';
                    newUrgency.style.cssText = `
                        background: linear-gradient(45deg, var(--presale-accent), #ff6b6b);
                        color: white;
                        padding: 15px;
                        border-radius: 10px;
                        margin: 20px 0;
                        text-align: center;
                        font-weight: bold;
                        animation: pulse 2s infinite;
                    `;
                    newUrgency.textContent = message;
                    document.querySelector('.hero-content').appendChild(newUrgency);
                }
            }

            handleCountdownExpired() {
                // Switch to waitlist mode
                document.querySelector('.countdown-timer').innerHTML = `
                    <div style="color: var(--presale-accent); font-weight: bold;">
                        ðŸš¨ Early Bird Pricing Has Ended
                    </div>
                    <div style="font-size: 0.9rem; margin-top: 10px;">
                        Join waitlist for regular pricing notification
                    </div>
                `;

                // Update CTA buttons
                document.querySelectorAll('.cta-primary').forEach(btn => {
                    btn.textContent = 'Join Waitlist - $39.99';
                    btn.style.background = 'linear-gradient(45deg, var(--presale-warning), #ffa502)';
                });
            }

            async initiateCheckout() {
                // Check if cart is empty
                const totalItems = Object.values(this.cart).reduce((sum, qty) => sum + qty, 0);
                if (totalItems === 0) {
                    alert('Please add items to your cart before checkout.');
                    return;
                }

                // Track conversion attempt
                this.trackAnalytics('checkout_initiated', {
                    count_at_checkout: this.currentCount,
                    time_remaining: this.countdownEndTime.getTime() - new Date().getTime(),
                    cart_items: Object.keys(this.cart).length,
                    cart_total_items: totalItems
                });

                // Disable checkout button and show loading
                const checkoutButton = document.getElementById('checkout-button');
                const originalText = checkoutButton.textContent;
                checkoutButton.disabled = true;
                checkoutButton.textContent = 'ðŸ”„ Creating Checkout Session...';
                checkoutButton.style.opacity = '0.7';

                try {
                    // Prepare line items for Stripe
                    const lineItems = [];
                    let totalAmount = 0;

                    Object.entries(this.cart).forEach(([productId, quantity]) => {
                        const product = this.products[productId];
                        const itemTotal = product.price * quantity;
                        totalAmount += itemTotal;

                        lineItems.push({
                            price_data: {
                                currency: 'usd',
                                product_data: {
                                    name: product.name,
                                    description: `Pre-order - Early bird pricing`,
                                    images: [`https://dampdrink.com/assets/images/products/${productId}/${productId}.png`]
                                },
                                unit_amount: Math.round(product.price * 100) // Convert to cents
                            },
                            quantity: quantity
                        });
                    });

                    // Create checkout session with multiple items
                    const response = await fetch('https://dampdrink.com/api/create-checkout-session', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            line_items: lineItems,
                            mode: 'payment',
                            success_url: `${window.location.origin}/pages/order-success.html?session_id={CHECKOUT_SESSION_ID}`,
                            cancel_url: `${window.location.origin}/pages/pre-sale-funnel.html`,
                            metadata: {
                                campaign: 'presale_funnel',
                                backer_number: this.currentCount + 1,
                                early_bird: 'true',
                                source: 'cart_checkout',
                                cart_items: JSON.stringify(this.cart),
                                total_amount: totalAmount.toFixed(2)
                            },
                            customer_email: null, // Will be collected by Stripe
                            shipping_address_collection: {
                                allowed_countries: ['US', 'CA', 'GB', 'AU', 'DE', 'FR', 'IT', 'ES', 'NL', 'BE', 'AT', 'CH']
                            }
                        })
                    });

                    if (!response.ok) {
                        const errorData = await response.json().catch(() => ({}));
                        throw new Error(errorData.error || `HTTP ${response.status}: Failed to create checkout session`);
                    }

                    const session = await response.json();

                    if (session.error) {
                        throw new Error(session.error);
                    }

                    // Initialize Stripe with proper public key
                    const stripe = Stripe('pk_live_51ReW7yCcrIDahSGRjE5nEx9ENwPj8uzAfCJQtmVBkuEyeS7JNq0xscaAqdUFoKos7JO1cKbJXrIscBfUU4yNRQSy00lWo3F7p2'); // Your actual live key

                    // Save cart to localStorage before redirect (in case user comes back)
                    localStorage.setItem('dampPreOrderCart', JSON.stringify(this.cart));

                    // Redirect to Stripe Checkout
                    const { error } = await stripe.redirectToCheckout({
                        sessionId: session.sessionId || session.id
                    });

                    if (error) {
                        throw new Error(error.message);
                    }

                } catch (error) {
                    console.error('Checkout error:', error);

                    // Show more helpful error message
                    let errorMessage = 'We\'re experiencing technical difficulties with our payment system.\n\n';

                    if (error.message.includes('404') || error.message.includes('Failed to fetch')) {
                        errorMessage += 'âŒ Our checkout service is temporarily unavailable.\n';
                        errorMessage += 'ðŸ”„ Please try again in a few moments.\n';
                    } else if (error.message.includes('Invalid product')) {
                        errorMessage += 'âŒ One or more selected products are currently unavailable.\n';
                        errorMessage += 'ðŸ›’ Please review your cart and try again.\n';
                    } else if (error.message.includes('network')) {
                        errorMessage += 'ðŸ“¡ Network connection issue detected.\n';
                        errorMessage += 'ðŸ”„ Please check your internet connection and try again.\n';
                    } else {
                        errorMessage += `âŒ Error: ${error.message}\n`;
                    }

                    errorMessage += '\nðŸ“§ For immediate assistance, contact our support team at support@dampdrink.com';
                    errorMessage += '\nðŸ’¬ Or use the live chat in the bottom-right corner of this page.';

                    alert(errorMessage);

                    // Re-enable button
                    checkoutButton.disabled = false;
                    checkoutButton.textContent = originalText;
                    checkoutButton.style.opacity = '1';
                }
            }

            setupAnalytics() {
                // Track page view
                this.trackAnalytics('presale_funnel_view', {
                    current_count: this.currentCount,
                    progress_percentage: (this.currentCount / this.goalCount) * 100
                });

                // Track scroll depth
                let maxScroll = 0;
                window.addEventListener('scroll', () => {
                    const scrollPercent = Math.round((window.scrollY / (document.body.scrollHeight - window.innerHeight)) * 100);
                    if (scrollPercent > maxScroll) {
                        maxScroll = scrollPercent;
                        if (maxScroll % 25 === 0) { // Track at 25%, 50%, 75%, 100%
                            this.trackAnalytics('scroll_depth', { depth: maxScroll });
                        }
                    }
                });

                // Track time on page
                let timeOnPage = 0;
                setInterval(() => {
                    timeOnPage += 30;
                    if (timeOnPage % 60 === 0) { // Every minute
                        this.trackAnalytics('time_on_page', { seconds: timeOnPage });
                    }
                }, 30000);
            }

            trackAnalytics(event, data = {}) {
                try {
                    if (window.gtag && this.hasAnalyticsConsent()) {
                        gtag('event', event, {
                            event_category: 'presale_funnel',
                            event_label: JSON.stringify(data),
                            custom_map: { dimension1: 'presale_conversion' }
                        });
                    }
                } catch (error) {
                    console.warn('Analytics tracking error:', error);
                }
            }

            hasAnalyticsConsent() {
                return localStorage.getItem('cookieAccepted') === 'true';
            }
        }

        // Initialize funnel when DOM is ready
        let preSaleFunnel;
        document.addEventListener('DOMContentLoaded', () => {
            preSaleFunnel = new PreSaleFunnel();
            window.preSaleFunnel = preSaleFunnel; // Make globally available
        });

        // Smooth scrolling for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });
    </script>

    <!-- Cookie Notice -->
    <div class="cookie-notice" id="cookieNotice" style="position: fixed; bottom: 20px; left: 20px; right: 20px; background: rgba(15, 15, 35, 0.95); backdrop-filter: blur(20px); border-radius: 10px; padding: 15px; color: white; font-size: 0.9rem; z-index: 1000; display: none;">
        ðŸª We use cookies to track pre-order progress and improve your experience.
        <a href="../pages/privacy.html" style="color: var(--presale-success);">Privacy Policy</a>
        <button onclick="acceptCookies()" style="background: var(--presale-success); color: white; border: none; padding: 8px 15px; border-radius: 5px; margin-left: 10px; cursor: pointer;">Accept</button>
    </div>

    <script>
        function acceptCookies() {
            document.getElementById('cookieNotice').style.display = 'none';
            localStorage.setItem('cookieAccepted', 'true');

            // Initialize analytics after consent
            if (window.gtag) {
                gtag('consent', 'update', {
                    'analytics_storage': 'granted'
                });
                gtag('event', 'page_view', {
                    page_title: document.title,
                    page_location: window.location.href
                });
            }
        }

        // Show cookie notice if not accepted
        if (!localStorage.getItem('cookieAccepted')) {
            setTimeout(() => {
                document.getElementById('cookieNotice').style.display = 'block';
            }, 3000);
        }
    </script>

    <!-- PWA Service Worker Registration -->
    <script>
        // Google PWA Standards Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', async () => {
                try {
                    const registration = await navigator.serviceWorker.register('/sw.js', {
                        scope: '/',
                        updateViaCache: 'none'
                    });
                    console.log('âœ… Service Worker registered:', registration.scope);

                    // Handle updates
                    registration.addEventListener('updatefound', () => {
                        const newWorker = registration.installing;
                        newWorker.addEventListener('statechange', () => {
                            if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                showUpdateNotification();
                            }
                        });
                    });

                    window.dampPWA = { registration };
                } catch (error) {
                    console.error('âŒ Service Worker failed:', error);
                }
            });
        }

        function showUpdateNotification() {
            const notification = document.createElement('div');
            notification.innerHTML = '<div style="position:fixed;top:20px;left:50%;transform:translateX(-50%);background:linear-gradient(135deg,#00d4ff,#00ff88);color:#1a1a2e;padding:15px 25px;border-radius:30px;font-weight:600;z-index:10000;display:flex;align-items:center;gap:15px;"><span>ðŸš€</span><span>New version available!</span><button onclick="refreshApp()" style="background:rgba(26,26,46,0.2);color:#1a1a2e;border:none;padding:8px 16px;border-radius:20px;font-weight:600;cursor:pointer;">Update</button><button onclick="this.parentElement.parentElement.remove()" style="background:transparent;border:none;color:#1a1a2e;cursor:pointer;padding:5px;">Ã—</button></div>';
            document.body.appendChild(notification);
        }

        function refreshApp() {
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.getRegistration().then(registration => {
                    if (registration && registration.waiting) {
                        registration.waiting.postMessage({ type: 'SKIP_WAITING' });
                        window.location.reload();
                    }
                });
            }
        }

        // Load Mobile App Redirect Script
        const mobileAppScript = document.createElement('script');
        mobileAppScript.src = '/assets/js/mobile-app-redirect.js';
        mobileAppScript.async = true;
        document.head.appendChild(mobileAppScript);
    </script></body>
</html>